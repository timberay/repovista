<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RepoVista JavaScript 테스트</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .result { margin: 10px 0; padding: 10px; border-radius: 3px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .warning { background-color: #fff3cd; color: #856404; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>RepoVista JavaScript 수정 테스트</h1>
    
    <div class="test-section">
        <h2>1. 모듈 로딩 테스트</h2>
        <div id="module-test-results"></div>
    </div>
    
    <div class="test-section">
        <h2>2. API 모듈 기능 테스트</h2>
        <div id="api-test-results"></div>
    </div>

    <div class="test-section">
        <h2>3. 컴포넌트 렌더링 테스트</h2>
        <div id="component-test-results"></div>
    </div>

    <!-- 모든 JavaScript 파일을 현재 로딩 순서로 포함 -->
    <script src="js/utils.js"></script>
    <!-- API Module Dependencies - Load in correct order -->
    <script src="js/http-client.js"></script>
    <script src="js/utilities.js"></script>
    <script src="js/repository-api.js"></script>
    <script src="js/tags-api.js"></script>
    <script src="js/registry-api.js"></script>
    <!-- Main API Module - Load after dependencies -->
    <script src="js/api.js"></script>
    <script src="js/sort-utils.js"></script>
    <script src="js/sort-tests.js"></script>
    <script src="js/store.js"></script>
    <script src="js/events.js"></script>
    <script src="js/error-handler.js"></script>
    <script src="js/render-engine.js"></script>
    <script src="js/components.js"></script>
    <script src="js/lifecycle.js"></script>
    <script src="js/component-registry.js"></script>
    <script src="js/advanced-components.js"></script>
    <script src="js/logger.js"></script>
    <script src="js/performance.js"></script>
    <script src="js/lazy-loader.js"></script>
    <script src="js/view-controller.js"></script>
    <script src="js/integration.js"></script>
    <script src="js/app.js"></script>

    <script>
        // 페이지 로드 완료 후 테스트 실행
        window.addEventListener('load', function() {
            console.log('페이지 로드 완료 - 테스트 시작');
            
            // 1. 모듈 로딩 테스트
            testModuleLoading();
            
            // 2. API 기능 테스트
            setTimeout(testAPIFunctionality, 1000);
            
            // 3. 컴포넌트 렌더링 테스트  
            setTimeout(testComponentRendering, 2000);
        });
        
        function logResult(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong>: ${message}`;
            container.appendChild(div);
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        function testModuleLoading() {
            const modules = [
                { name: 'App', obj: window.App },
                { name: 'App.Utils', obj: window.App?.Utils },
                { name: 'App.HttpClient', obj: window.App?.HttpClient },
                { name: 'App.Utilities', obj: window.App?.Utilities },
                { name: 'App.RepositoryAPI', obj: window.App?.RepositoryAPI },
                { name: 'App.TagsAPI', obj: window.App?.TagsAPI },
                { name: 'App.RegistryAPI', obj: window.App?.RegistryAPI },
                { name: 'App.API', obj: window.App?.API }
            ];
            
            let loadedCount = 0;
            modules.forEach(module => {
                if (module.obj) {
                    logResult('module-test-results', `✅ ${module.name} 모듈 로드됨`, 'success');
                    loadedCount++;
                } else {
                    logResult('module-test-results', `❌ ${module.name} 모듈 없음`, 'error');
                }
            });
            
            logResult('module-test-results', `총 ${loadedCount}/${modules.length} 모듈이 성공적으로 로드되었습니다.`, 
                loadedCount === modules.length ? 'success' : 'warning');
        }
        
        async function testAPIFunctionality() {
            try {
                if (!window.App?.API) {
                    logResult('api-test-results', '❌ App.API 모듈을 찾을 수 없습니다', 'error');
                    return;
                }
                
                // Health check 테스트
                logResult('api-test-results', '⏳ API Health check 테스트 중...', 'info');
                
                try {
                    const health = await window.App.API.getHealth();
                    logResult('api-test-results', `✅ Health check 성공: ${JSON.stringify(health)}`, 'success');
                } catch (error) {
                    logResult('api-test-results', `❌ Health check 실패: ${error.message}`, 'error');
                }
                
                // Repository 목록 테스트
                logResult('api-test-results', '⏳ Repository 목록 테스트 중...', 'info');
                
                try {
                    const repos = await window.App.API.getRepositories({ limit: 3 });
                    logResult('api-test-results', `✅ Repository 목록 조회 성공: ${repos.repositories?.length || 0}개 항목`, 'success');
                } catch (error) {
                    logResult('api-test-results', `❌ Repository 목록 조회 실패: ${error.message}`, 'error');
                }
                
            } catch (error) {
                logResult('api-test-results', `❌ API 테스트 중 오류 발생: ${error.message}`, 'error');
            }
        }
        
        function testComponentRendering() {
            try {
                if (!window.App?.h) {
                    logResult('component-test-results', '❌ App.h (render function)를 찾을 수 없습니다', 'error');
                    return;
                }
                
                logResult('component-test-results', '⏳ 컴포넌트 렌더링 테스트 중...', 'info');
                
                // 간단한 컴포넌트 렌더링 테스트
                const testElement = window.App.h('div', 
                    { className: 'test-component' }, 
                    window.App.h('span', {}, 'Test Component')
                );
                
                if (testElement) {
                    logResult('component-test-results', '✅ 기본 컴포넌트 렌더링 성공', 'success');
                } else {
                    logResult('component-test-results', '❌ 컴포넌트 렌더링 실패', 'error');
                }
                
            } catch (error) {
                logResult('component-test-results', `❌ 컴포넌트 테스트 중 오류: ${error.message}`, 'error');
            }
        }
        
        // 전역 오류 캐치
        window.addEventListener('error', function(event) {
            console.error('JavaScript 오류 발생:', event.error);
            const container = document.getElementById('module-test-results');
            if (container) {
                logResult('module-test-results', `❌ JavaScript 오류: ${event.error.message}`, 'error');
                logResult('module-test-results', `파일: ${event.filename}:${event.lineno}`, 'error');
            }
        });
        
        window.addEventListener('unhandledrejection', function(event) {
            console.error('Promise 거부:', event.reason);
            const container = document.getElementById('api-test-results');
            if (container) {
                logResult('api-test-results', `❌ Promise 거부: ${event.reason}`, 'error');
            }
        });
    </script>
</body>
</html>